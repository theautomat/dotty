import{initializeFirebase as m}from"./firebase-module-CC4uiIcR.js";import{w as f,K as g,t as v,u as y,M as h}from"./main-SK6jyTFi.js";import"https://esm.sh/htm/preact/standalone";class p{constructor(){this.initialized=!1,this.app=null,this.db=null,this.analytics=null}async initialize(){if(this.initialized)return!0;try{const e=m();return this.app=e.app,this.db=e.db,this.analytics=e.analytics,this.initialized=!0,console.log("Cloud Firestore initialized successfully"),!0}catch(e){return console.error("CRITICAL: Firebase initialization failed:",e),this.initialized=!1,!1}}async saveGameStats(e,i){var r,o,s,n,l,c,d;if(!this.initialized&&(console.log("Firebase not initialized, attempting to initialize now..."),!await this.initialize()))return console.error("Cannot save game stats: Firebase not initialized"),!1;if(!this.db)return console.error("Cannot save game stats: Cloud Firestore not available"),!1;try{if(!e||typeof e!="string"||e.length<5)return console.error("Invalid fingerprint ID for saving game stats:",e),!1;const a=i.gameId||`game_${Date.now()}`,u={gameId:a,playerId:e,score:i.score,asteroidsDestroyed:i.asteroidsDestroyed,totalOresMined:i.totalOresMined,gameTime:i.gameTime,level:((r=i.level)==null?void 0:r.id)||0,levelName:((o=i.level)==null?void 0:o.name)||"",oresMined:{iron:((s=i.oresMined)==null?void 0:s.iron)||0,copper:((n=i.oresMined)==null?void 0:n.copper)||0,silver:((l=i.oresMined)==null?void 0:l.silver)||0,gold:((c=i.oresMined)==null?void 0:c.gold)||0,platinum:((d=i.oresMined)==null?void 0:d.platinum)||0},eventType:i.eventType||"unknown",timestamp:new Date().toISOString(),created:Date.now()};console.log(`Saving game stats for player ${e}, game ${a}`);try{if(a){const t=f(this.db,"games",a);await g(t,u),console.log(`Game stats saved successfully with ID: ${a}`)}else{const t=await v(y(this.db,"games"),u);console.log(`Game stats saved successfully with auto ID: ${t.id}`)}return!0}catch(t){return console.error("Firestore write failed:",t),!1}}catch(a){return console.error("Failed to save game stats:",a),!1}}async trackEvent(e,i={}){try{return this.analytics?(h(this.analytics,e,i),console.debug(`Analytics event tracked: ${e}`),!0):(console.debug("Analytics not available for event tracking"),!1)}catch(r){return console.warn("Failed to track analytics event:",r),!1}}}const F=new p;export{F as default};
//# sourceMappingURL=firebase-service-DbZXI7HI.js.map
